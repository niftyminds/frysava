---
import yaml from 'js-yaml';
import fs from 'fs';
import path from 'path';

const siteDataPath = path.join(process.cwd(), 'src/data/site.yaml');
const siteData = yaml.load(fs.readFileSync(siteDataPath, 'utf8'));

const carouselImages = siteData.hero_images || [];
const heroSlogan = siteData.hero_slogan || "Tady chci zpomalit a být";
---

<section id="uvod" class="relative md:h-screen md:min-h-[600px] overflow-hidden">
  <!-- Mobile Static Image -->
  <div class="md:hidden relative">
    <img
      src={carouselImages[0]?.path}
      alt={carouselImages[0]?.alt || "Chalupa na Fryšavě"}
      class="w-full h-auto"
      loading="eager"
    />
    <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/20 to-black/50"></div>
  </div>

  <!-- Desktop Carousel Container -->
  <div class="hidden md:block embla h-full" data-embla>
    <div class="embla__container h-full">
      {carouselImages.map((image, index) => (
        <div class="embla__slide relative h-full">
          <img
            src={image.path}
            alt={image.alt || `Chalupa na Fryšavě ${index + 1}`}
            class="w-full h-full object-cover"
            loading={index === 0 ? 'eager' : 'lazy'}
          />
          <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/20 to-black/50"></div>
        </div>
      ))}
    </div>
  </div>

  <!-- Content Overlay -->
  <div class="absolute inset-0 z-10 flex items-center justify-center">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl sm:text-4xl md:text-6xl lg:text-7xl font-medium mb-4 md:mb-6 text-white drop-shadow-lg">
        {siteData.name}
      </h1>
      <p class="text-base sm:text-lg md:text-2xl mb-6 md:mb-10 max-w-2xl mx-auto text-white/90 drop-shadow-md font-light tracking-wide">
        {heroSlogan}
      </p>

      <!-- CTA Buttons -->
      <div class="flex flex-row gap-3 md:gap-4 justify-center items-center">
        <a href="/rezervace" class="btn-primary text-sm sm:text-base md:text-lg px-6 sm:px-8 md:px-10 py-2.5 sm:py-3 md:py-4 inline-block">
          Rezervace
        </a>
        <a
          href="#o-chalupe"
          class="hidden sm:inline-block px-6 md:px-10 py-3 md:py-4 text-base md:text-lg font-medium text-white border-2 border-white/80 hover:bg-white/10 hover:border-white transition-all duration-200 rounded-lg"
        >
          Více informací
        </a>
      </div>
    </div>
  </div>

  <!-- Carousel Navigation Dots -->
  <div class="hidden md:flex absolute bottom-8 left-1/2 transform -translate-x-1/2 z-20 gap-1" id="carousel-dots">
    {carouselImages.map((_, index) => (
      <button
        class="carousel-dot flex items-center justify-center w-11 h-11 rounded-full hover:bg-white/10 transition-all duration-300"
        data-index={index}
        aria-label={`Přejít na obrázek ${index + 1}`}
      >
        <span class="block w-2.5 h-2.5 rounded-full bg-white/40"></span>
      </button>
    ))}
  </div>
</section>

<style>
  .embla {
    overflow: hidden;
  }
  .embla__container {
    display: flex;
    height: 100%;
  }
  .embla__slide {
    flex: 0 0 100%;
    min-width: 0;
  }

  /* Fade transition effect */
  .embla__slide {
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }

  .embla__slide.is-active {
    opacity: 1;
  }

  /* Carousel dots active state */
  .carousel-dot.is-active span {
    @apply bg-white w-8;
  }

  .carousel-dot span {
    transition: all 0.3s ease;
  }
</style>

<script>
  import EmblaCarousel from 'embla-carousel';
  import Autoplay from 'embla-carousel-autoplay';

  const emblaNode = document.querySelector('[data-embla]');
  const dotsContainer = document.getElementById('carousel-dots');

  if (emblaNode) {
    const embla = EmblaCarousel(emblaNode, {
      loop: true,
      duration: 70,
    }, [
      Autoplay({
        delay: 7000,
        stopOnInteraction: false,
      })
    ]);

    const slides = emblaNode.querySelectorAll('.embla__slide');
    const dots = dotsContainer?.querySelectorAll('.carousel-dot');

    const updateActiveSlide = () => {
      const selectedIndex = embla.selectedScrollSnap();

      // Update slides
      slides.forEach((slide, index) => {
        if (index === selectedIndex) {
          slide.classList.add('is-active');
        } else {
          slide.classList.remove('is-active');
        }
      });

      // Update dots
      dots?.forEach((dot, index) => {
        if (index === selectedIndex) {
          dot.classList.add('is-active');
        } else {
          dot.classList.remove('is-active');
        }
      });
    };

    // Click on dot to navigate
    dots?.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        embla.scrollTo(index);
      });
    });

    embla.on('select', updateActiveSlide);
    embla.on('init', updateActiveSlide);

    updateActiveSlide();
  }
</script>
