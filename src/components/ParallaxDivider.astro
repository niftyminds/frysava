---
// Parallax divider for visual separation between sections
const backgroundImage = '/images/large/chalupa-frysava-pod-zakovou-horou-8dac-570472.webp';
const quote = "Večer světlo kostela, ráno zpěv ptáků.";
---

<section class="relative h-[60vh] min-h-[450px] sm:h-[70vh] sm:min-h-[500px] lg:h-[75vh] lg:min-h-[600px] max-h-[800px] overflow-hidden">
  <!-- Parallax Background - Professional implementation -->
  <div
    class="parallax-bg absolute inset-0 bg-cover bg-center scale-110"
    style={`background-image: url('${backgroundImage}'); background-position: center 40%;`}
    data-parallax
    data-speed="0.5"
  ></div>

  <!-- Refined Gradient Overlay -->
  <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/30 to-black/50"></div>

  <!-- Content -->
  <div class="relative z-10 flex items-center justify-center h-full px-4 sm:px-8">
    <div class="text-center max-w-4xl">
      <!-- Decorative line above -->
      <div class="flex justify-center mb-6">
        <span class="block w-16 h-0.5 bg-white/60"></span>
      </div>

      <blockquote class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-serif italic text-white leading-relaxed">
        "{quote}"
      </blockquote>

      <!-- Decorative line below -->
      <div class="flex justify-center mt-6">
        <span class="block w-16 h-0.5 bg-white/60"></span>
      </div>
    </div>
  </div>
</section>

<style>
  .parallax-bg {
    will-change: transform;
  }

  /* Disable parallax for reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .parallax-bg {
      transform: none !important;
    }
  }
</style>

<script>
  // Parallax scroll effect with centered calculation
  function updateParallax() {
    var parallaxElements = document.querySelectorAll('[data-parallax]');

    parallaxElements.forEach(function(el) {
      var rect = el.getBoundingClientRect();
      var speed = parseFloat(el.getAttribute('data-speed') || '0.3');

      // Only apply parallax when element is in viewport
      if (rect.top < window.innerHeight && rect.bottom > 0) {
        // Centered parallax calculation to prevent white stripes
        var viewportCenter = window.innerHeight / 2;
        var elementCenter = rect.top + (rect.height / 2);
        var offset = (viewportCenter - elementCenter) * speed;
        el.style.transform = 'translateY(' + offset + 'px)';
      }
    });
  }

  // Check for reduced motion preference
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReducedMotion) {
    window.addEventListener('scroll', updateParallax, { passive: true });
    updateParallax(); // Initial call

    // Cleanup for SPA navigation (Astro View Transitions)
    document.addEventListener('astro:before-swap', () => {
      window.removeEventListener('scroll', updateParallax);
    }, { once: true });
  }
</script>
